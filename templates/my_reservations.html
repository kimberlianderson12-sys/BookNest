{% extends "base.html" %}

{% block title %}Мои бронирования - BookNest{% endblock %}

{% block content %}
<div class="reservations-page">
    <a href="{{ url_for('dashboard') }}" class="back-link">← Назад на главную</a>
    <h1>Мои бронирования</h1>
    
    <div class="filter-section" style="margin-bottom: 20px;">
        <form method="GET" action="{{ url_for('my_reservations') }}" class="filter-form" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
            <label for="status" style="color: var(--text-color); font-weight: 500;">Фильтр по статусу:</label>
            <select name="status" id="status" class="form-select" style="width: auto; min-width: 200px;">
                <option value="">Все бронирования</option>
                <option value="reserved" {% if status_filter == 'reserved' %}selected{% endif %}>Забронировано</option>
                <option value="issued" {% if status_filter == 'issued' %}selected{% endif %}>Выдано</option>
                <option value="returned" {% if status_filter == 'returned' %}selected{% endif %}>Возвращено</option>
                <option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Отменено</option>
            </select>
            <button type="submit" class="btn btn-primary">Применить</button>
            {% if status_filter %}
            <a href="{{ url_for('my_reservations') }}" class="btn btn-secondary">Сбросить</a>
            {% endif %}
        </form>
    </div>
    
    {% if reservations %}
    <table class="reservations-table">
        <thead>
            <tr>
                <th>Книга</th>
                <th>Инвентарный номер</th>
                <th>Дата бронирования</th>
                <th>Срок получения</th>
                <th>Срок возврата</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for res in reservations %}
            <tr>
                <td data-label="Книга">{{ res.title }}</td>
                <td data-label="Инвентарный номер">{{ res.inventory_number }}</td>
                <td data-label="Дата бронирования">{{ res.reservation_date.strftime('%d.%m.%Y %H:%M') if res.reservation_date else 'N/A' }}</td>
                <td data-label="Срок получения">{{ res.pickup_deadline.strftime('%d.%m.%Y %H:%M') if res.pickup_deadline else 'N/A' }}</td>
                <td data-label="Срок возврата">{{ res.due_date.strftime('%d.%m.%Y') if res.due_date else 'N/A' }}</td>
                <td data-label="Статус">
                    {% if res.status == 'reserved' %}
                    <span class="badge badge-warning">Забронировано</span>
                    {% elif res.status == 'issued' %}
                    <span class="badge badge-info">Выдано</span>
                    {% elif res.status == 'returned' %}
                    <span class="badge badge-success">Возвращено</span>
                    {% elif res.status == 'cancelled' %}
                    <span class="badge badge-secondary">Отменено</span>
                    {% else %}
                    <span class="badge">{{ res.status }}</span>
                    {% endif %}
                </td>
                <td data-label="Действия">
                    {% if res.status == 'reserved' or res.status == 'issued' %}
                    <form method="POST" action="{{ url_for('cancel_reservation', copy_id=res.copy_id) }}" style="display: inline;">
                        <input type="hidden" name="reservation_date" value="{{ res.reservation_date.isoformat() if res.reservation_date else '' }}">
                        <button type="submit" class="btn btn-danger btn-sm" 
                                onclick="return confirm('Вы уверены, что хотите отменить бронирование? Книга будет возвращена в библиотеку.')">
                            Отменить
                        </button>
                    </form>
                    {% else %}
                    <span style="color: var(--text-light);">—</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>
            {% if status_filter %}
                У вас нет бронирований с выбранным статусом
            {% else %}
                У вас нет бронирований
            {% endif %}
        </p>
        <a href="{{ url_for('books') }}" class="btn btn-primary">Найти книги</a>
    </div>
    {% endif %}
</div>
{% endblock %}

